<!DOCTYPE html>
<html lang="de">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Marker auf OSM</title>

		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
		<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>

		<style>
			body { padding: 0.5vw; margin:0 ;}
			#mapid { width: 98vw; height: 98vh; }
		</style>
	</head>

	<body>
		<div id="mapid">
			<p>Aufruf mit: .../osm_marker.html?lat=n.n,lon=n.n[,zoom=n][,info=Text][;lat=n.n,lon=n.n[,zoom=n][,info=Text]] ...</p>
			<p>Beispiel: <a href="?lat=52.518493,lon=13.376026,info=Reichstagsgebäude,zoom=15" >.../osm_marker.html?lat=52.518493,lon=13.376026,info=Reichstagsgebäude,zoom=15</a></p>
			<p>Beispiel: <a href="?lat=52.518493,lon=13.376026,info=Reichstagsgebäude;lat=52.516195,lon=13.377442,info=Brandenburger Tor;lat=52.519981,lon=13.36916,info=Bundeskanzleramt" >.../osm_marker.html?lat=52.518493,lon=13.376026,info=Reichstagsgebäude;lat=52.516195,lon=13.377442,info=Brandenburger Tor;lat=52.519981,lon=13.36916,info=Bundeskanzleramt</a></p>
		</div>

		<script>
			"use strict";
			if(window.location.search) {
				document.getElementById("mapid").innerHTML = "";

				var parstring,parsets,pars,pair,i,j,lat,lon,info,zoom,tempdiv;
				var latmin=180,latmax=-180,lonmin=90,lonmax=-90,zoommin=20;
				var marker = [];

				parstring = decodeURI(window.location.search.substring(1));
				parstring = parstring.replace(/ *= */g,"=").replace(/ *, */g,",").replace(/ *; */g,";");
				tempdiv = document.createElement("div");
				tempdiv.innerHTML = parstring;
				parstring = tempdiv.textContent;
				parstring = parstring.replace(/\\n/g,"<br>");

				parsets = parstring.split(";");
				for(i=0;i<parsets.length;i++) {
					pars = parsets[i].split(",");
					lat = 51.477344;
					lon = 0.0;
					info = "";
					zoom = 1;
					for(j=0;j<pars.length;j++) {
						pair = pars[j].split("=");
						if(pair.length = 2) {
							switch(pair[0]) {
								case "lat":
									lat = pair[1];
									if(lat<latmin) latmin = lat;
									if(lat>latmax) latmax = lat;
									break;
								case "lon":
									lon = pair[1];
									if(lon<lonmin) lonmin = lon;
									if(lon>lonmax) lonmax = lon;
									break;
								case "info":
									info = pair[1];
									break;
								case "zoom":
									zoom = pair[1];
									if(zoom<zoommin) zoommin = zoom;
									break;
							}
						}
					}
					marker.push({lat:lat,lon:lon,info:info});
				}

				var mymap;
				if(marker.length == 1)     mymap = L.map('mapid').setView([marker[0].lat,marker[0].lon], zoommin);
				else if(marker.length > 1) mymap = L.map('mapid').fitBounds([[latmin, lonmin],[latmax, lonmax]]);

				L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
					maxZoom: 18,
					attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
						'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
						'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
					id: 'mapbox.streets'
				}).addTo(mymap);
				//lat=50.70476,lon=7.13490
				L.marker([50.70476, 7.13490]).addTo(mymap)
				    .bindPopup('<img src="https://s-ec.bstatic.com/images/hotel/max1024x768/337/33750878.jpg" width="150px"><br><a href="https://www.maritim.de/de/hotels/deutschland/hotel-bonn/unser-hotel" target="_blank">Hotel Maritim Bonn</a>')
				    .openPopup();

				// for(i=0;i<marker.length;i++) {
				// 	if(marker[i].info.length) {
				// 		if(marker.length>1) {
				// 			L.marker([marker[i].lat,marker[i].lon]).addTo(mymap).bindPopup(marker[i].info);
				// 		}
				// 		else {
				// 			L.marker([marker[i].lat,marker[i].lon]).addTo(mymap).bindPopup(marker[i].info).openPopup();
				// 		}
				// 	}
				// 	else  {
				// 		L.marker([marker[i].lat,marker[i].lon]).addTo(mymap);
				// 	}
				// }
			}
		</script>

	</body>
</html>
